{"version":3,"sources":["webpack:///webpack/bootstrap 3915c883a4348328fe8a","webpack:///./Cell.js","webpack:///./Field.js","webpack:///./ScalarField.js","webpack:///./Vector.js","webpack:///./VectorField.js","webpack:///./control/L.Control.ColorBar.js","webpack:///./layer/L.CanvasLayer.Field.js","webpack:///./layer/L.CanvasLayer.ScalarField.js","webpack:///./layer/L.CanvasLayer.SimpleLonLat.js","webpack:///./layer/L.CanvasLayer.VectorFieldAnim.js","webpack:///./layer/L.CanvasLayer.js","webpack:///../~/@turf/inside/index.js","webpack:///../~/@turf/invariant/index.js","webpack:///./_main.js"],"names":["Cell","center","value","xSize","ySize","anotherCell","equals","_equalValues","anotherValue","type","constructor","name","answerFor","Number","Vector","u","v","halfX","halfY","cLat","lat","cLng","lng","ul","L","latLng","lr","latLngBounds","Field","params","nCols","nRows","width","height","xllCorner","yllCorner","xurCorner","yurCorner","cellXSize","cellYSize","grid","isContinuous","longitudeNeedsToBeWrapped","_inFilter","_spatialMask","TypeError","range","_calculateRange","stride","cells","j","i","_lonLatAtIndexes","lon","_valueAtIndexes","c","push","f","_updateRange","m","_getWrappedLongitudes","xmin","xmax","_pointInMask","_pointInExtent","longitudeIn","latitudeIn","pt","geometry","coordinates","properties","poly","inside","contains","notContains","_getDecimalIndexes","interpolatedValueAtIndexes","indexes","_getFourSurroundingIndexes","fi","ci","fj","cj","values","_getFourSurroundingValues","g00","g10","g01","g11","_doInterpolation","Math","floor","_clampColumnIndex","_clampRowIndex","row","_isValid","ii","jj","valueAt","hasValue","included","hasValueAt","o","random","x","_longitudeAtX","y","_latitudeAtY","halfXPixel","halfYPixel","maxCol","maxRow","undefined","ScalarField","asc","scaleFactor","lines","split","_checkIsValidASCIIGridHeader","n","cellSize","parseFloat","match","p","parseInt","noDataValue","toUpperCase","replace","trim","zs","length","line","items","forEach","it","upperCasesLines","map","lin","parameters","expected","found","indexOf","data","bandIndex","tiff","GeoTIFF","parse","image","getImage","rasters","readRasters","tiepoint","getTiePoints","fileDirectory","getFileDirectory","ModelPixelScale","xScale","yScale","GDAL_NODATA","noData","simpleZS","Array","from","z","getWidth","getHeight","_buildGrid","_arrayTo2d","array","filter","d3","min","max","rx","ry","sqrt","verticalAngle","atan2","inDegrees","PI","a","directionTo","opposite","VectorField","ascU","ascV","fromASCIIGrid","_paramsFromScalarFields","gtU","gtV","fromGeoTIFF","geotiffData","bandIndexesForUV","us","vs","_getFunctionFor","_applyOnField","uv","func","numCells","_arraysTo2d","valid","vectors","getCells","magnitudes","magnitude","b","d","Control","ColorBar","extend","options","position","margin","background","textColor","steps","decimals","units","title","labels","labelFontSize","labelTextPosition","initialize","color","Util","setOptions","onAdd","_map","div","DomUtil","create","style","padding","DomEvent","addListener","stopPropagation","preventDefault","backgroundColor","cursor","innerHTML","palette","document","createElement","select","append","attr","text","svg","_createSvgIn","_appendColorBarTo","_appendLabelsTo","spaceForLabels","colorPerValue","_getColorPerValue","w","groupBars","buckets","selectAll","enter","hex","toFixed","positionPerLabelValue","_getPositionPerLabelValue","groupLabels","delta","xPositionFor","scaleLinear","domain","positionPerLabel","control","colorBar","CanvasLayer","mouseMoveCursor","noValue","opacity","onClick","onMouseMove","inFilter","field","_visible","setData","getEvents","events","prototype","call","zoomstart","_hideCanvas","bind","zoomend","_showCanvas","onLayerDidMount","_enableIdentify","_ensureCanvasAlignment","show","hide","_disableIdentify","isVisible","_canvas","visibility","on","_onClick","_onMouseMove","off","topLeft","containerPointToLayerPoint","setPosition","onLayerWillUnmount","needRedraw","_field","onDrawLayer","viewInfo","setFilter","fire","setOpacity","_updateOpacity","getBounds","bb","extent","southWest","northEast","bounds","e","_queryValue","_changeCursorOn","getContainer","latlng","result","_getDrawingContext","g","getContext","clearRect","interpolate","vectorSize","arrowDirection","scalarField","_defaultColorScale","chroma","scale","setColor","r","_getRendererMethod","_drawImage","_drawArrows","Error","_ensureColor","ctx","img","createImageData","_prepareImageIn","putImageData","pos","pointCoords","containerPointToLatLng","_getColorFor","rgba","R","G","B","A","_pixelBounds","pixelSize","strokeStyle","currentBounds","cell","_drawArrow","northWest","latLngToContainerPoint","getNorthWest","southEast","getSouthEast","pixelBounds","projected","size","save","translate","rotationRads","rotate","beginPath","moveTo","lineTo","stroke","restore","canvasLayer","SimpleLonLat","points","canvas","fillStyle","point","layer","fillRect","fill","closePath","xs","ys","ymin","ymax","simpleLonLat","lonslats","VectorFieldAnim","paths","fade","duration","maxAge","velocityScale","vectorField","timer","_stopAnimation","_prepareParticlePaths","_moveParticles","_drawParticles","self","par","age","randomPosition","vector","xt","yt","prev","globalCompositeOperation","lineWidth","_drawParticle","source","target","pA","pB","_randomAge","stop","vectorFieldAnim","Layer","_frame","_delegate","delegate","del","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","newSize","_onLayerDidMove","resize","moveend","zoomAnimation","Browser","any3d","zoomanim","_animateZoom","tiles","getSize","animated","addClass","_panes","overlayPane","appendChild","onRemove","getPanes","removeChild","addTo","addLayer","LatLonToMercator","latlon","log","tan","zoom","getZoom","getCenter","corner","getZoomScale","offset","_latLngToNewLayerPoint","setTransform","window","require","console"],"mappings":"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iB;AAC5B,WAAW,iCAAiC;AAC5C,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvGA;AACA;AACA;AACA;AACA,WAAW,6CAA6C;AACxD,aAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,+BAA+B;AAC1C,aAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC,cAAc;AACtD,yBAAyB,kBAAkB;AAC3C;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC,wBAAwB;AAChE,yBAAyB,kBAAkB;AAC3C;AACA;AACA,WAAW,kBAAkB;AAC7B,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,uCAAuC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,iBAAiB;AAC5B,aAAa,cAAc;AAC3B,YAAY,MAAM;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,iBAAiB;AAC5B,aAAa,OAAO;AACpB,YAAY,MAAM;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9MA;AAAA;AACA;AACAuM,OAAO/b,CAAP,CAASV,MAAT,GAAkB,2DAAlB;;AAEA;AACAyc,OAAO/b,CAAP,CAASxB,IAAT,GAAgB,yDAAhB;;AAEA;AACAud,OAAO/b,CAAP,CAASI,KAAT,GAAiB,0DAAjB;;AAEA;AACA2b,OAAO/b,CAAP,CAASyF,WAAT,GAAuB,gEAAvB;;AAEA;AACAsW,OAAO/b,CAAP,CAAS+J,WAAT,GAAuB,gEAAvB;;AAEA;AACA,mBAAAiS,CAAQ,EAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;;AAEA;AACA,mBAAAA,CAAQ,CAAR;;AAEA;AACAC,QAAQZ,GAAR,CAAY,iDAAZ;AACA,8B","file":"leaflet.canvaslayer.field.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3915c883a4348328fe8a","/**\n *  Simple regular cell in a raster\n */\nexport default class Cell {\n    /**\n     * A simple cell with a numerical value\n     * @param {L.LatLng} center\n     * @param {Number|Vector} value\n     * @param {Number} xSize\n     * @param {Number} ySize\n     */\n    constructor(center, value, xSize, ySize = xSize) {\n        this.center = center;\n        this.value = value;\n        this.xSize = xSize;\n        this.ySize = ySize;\n    }\n\n    equals(anotherCell) {\n        return (\n            this.center.equals(anotherCell.center) &&\n            this._equalValues(this.value, anotherCell.value) &&\n            this.xSize === anotherCell.xSize &&\n            this.ySize === anotherCell.ySize\n        );\n    }\n\n    _equalValues(value, anotherValue) {\n        let type = value.constructor.name;\n        let answerFor = {\n            Number: value === anotherValue,\n            Vector: value.u === anotherValue.u && value.v === anotherValue.v\n        };\n        return answerFor[type];\n    }\n\n    /**\n     * Bounds for the cell\n     * @returns {LatLngBounds}\n     */\n    getBounds() {\n        let halfX = this.xSize / 2.0;\n        let halfY = this.ySize / 2.0;\n        let cLat = this.center.lat;\n        let cLng = this.center.lng;\n        let ul = L.latLng([cLat + halfY, cLng - halfX]);\n        let lr = L.latLng([cLat - halfY, cLng + halfX]);\n\n        return L.latLngBounds(\n            L.latLng(lr.lat, ul.lng),\n            L.latLng(ul.lat, lr.lng)\n        );\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Cell.js","import Cell from './Cell';\nimport inside from '@turf/inside';\n\n/**\n *  Abstract class for a set of values (Vector | Scalar)\n *  assigned to a regular 2D-grid (lon-lat), aka 'a Raster source'\n */\nexport default class Field {\n    constructor(params) {\n        this.params = params;\n\n        this.nCols = params['nCols'];\n        this.nRows = params['nRows'];\n\n        // alias\n        this.width = params['nCols'];\n        this.height = params['nRows'];\n\n        // ll = lower-left\n        this.xllCorner = params['xllCorner'];\n        this.yllCorner = params['yllCorner'];\n\n        // ur = upper-right\n        this.xurCorner =\n            params['xllCorner'] + params['nCols'] * params['cellXSize'];\n        this.yurCorner =\n            params['yllCorner'] + params['nRows'] * params['cellYSize'];\n\n        this.cellXSize = params['cellXSize'];\n        this.cellYSize = params['cellYSize'];\n\n        this.grid = null; // to be defined by subclasses\n        this.isContinuous = this.xurCorner - this.xllCorner >= 360;\n        this.longitudeNeedsToBeWrapped = this.xurCorner > 180; // [0, 360] --> [-180, 180]\n\n        this._inFilter = null;\n        this._spatialMask = null;\n    }\n\n    /**\n     * Builds a grid with a value at each point (either Vector or Number)\n     * Original params must include the required input values, following\n     * x-ascending & y-descending order (same as in ASCIIGrid)\n     * @abstract\n     * @private\n     * @returns {Array.<Array.<Vector|Number>>} - grid[row][column]--> Vector|Number\n     */\n    _buildGrid() {\n        throw new TypeError('Must be overriden');\n    }\n\n    _updateRange() {\n        this.range = this._calculateRange();\n    }\n\n    /**\n     * Number of cells in the grid (rows * cols)\n     * @returns {Number}\n     */\n    numCells() {\n        return this.nRows * this.nCols;\n    }\n\n    /**\n     * A list with every cell\n     * @returns {Array<Cell>} - cells (x-ascending & y-descending order)\n     */\n    getCells(stride = 1) {\n        let cells = [];\n        for (let j = 0; j < this.nRows; j = j + stride) {\n            for (let i = 0; i < this.nCols; i = i + stride) {\n                let [lon, lat] = this._lonLatAtIndexes(i, j);\n                let center = L.latLng(lat, lon);\n                let value = this._valueAtIndexes(i, j);\n                let c = new Cell(center, value, this.cellXSize, this.cellYSize);\n                cells.push(c); // <<\n            }\n        }\n        return cells;\n    }\n\n    /**\n     * Apply a filter function to field values\n     * @param   {Function} f - boolean function\n     */\n    setFilter(f) {\n        this._inFilter = f;\n        this._updateRange();\n    }\n\n    /**\n     * Apply a spatial mask to field values\n     * @param {L.GeoJSON} m \n     */\n    setSpatialMask(m) {\n        this._spatialMask = m;\n    }\n\n    /**\n     * Grid extent\n     * @returns {Number[]} [xmin, ymin, xmax, ymax]\n     */\n    extent() {\n        let [xmin, xmax] = this._getWrappedLongitudes();\n        return [xmin, this.yllCorner, xmax, this.yurCorner];\n    }\n\n    /**\n     * [xmin, xmax] in [-180, 180] range\n     */\n    _getWrappedLongitudes() {\n        let xmin = this.xllCorner;\n        let xmax = this.xurCorner;\n\n        if (this.longitudeNeedsToBeWrapped) {\n            if (this.isContinuous) {\n                xmin = -180;\n                xmax = 180;\n            } else {\n                // not sure about this (just one particular case, but others...?)\n                xmax = this.xurCorner - 360;\n                xmin = this.xllCorner - 360;\n                /* eslint-disable no-console */\n                // console.warn(`are these xmin: ${xmin} & xmax: ${xmax} OK?`);\n                // TODO: Better throw an exception on no-controlled situations.\n                /* eslint-enable no-console */\n            }\n        }\n        return [xmin, xmax];\n    }\n\n    /**\n     * Returns whether or not the grid contains the point, considering\n     * the spatialMask if it has been previously set\n     * @param   {Number} lon - longitude\n     * @param   {Number} lat - latitude\n     * @returns {Boolean}\n     */\n    contains(lon, lat) {\n        if (this._spatialMask) {\n            return this._pointInMask(lon, lat);\n        }\n        return this._pointInExtent(lon, lat);\n    }\n\n    /**\n     * Checks if coordinates are inside the Extent (considering wrapped longitudes if needed)\n     * @param {Number} lon \n     * @param {Number} lat \n     */\n    _pointInExtent(lon, lat) {\n        let [xmin, xmax] = this._getWrappedLongitudes();\n        let longitudeIn = lon >= xmin && lon <= xmax;\n        let latitudeIn = lat >= this.yllCorner && lat <= this.yurCorner;\n        return longitudeIn && latitudeIn;\n    }\n\n    /**\n     * Check if coordinates are inside the spatialMask (Point in Polygon analysis)\n     * @param {Number} lon \n     * @param {Number} lat \n     */\n    _pointInMask(lon, lat) {\n        const pt = {\n            type: 'Feature',\n            geometry: {\n                type: 'Point',\n                coordinates: [lon, lat] // geojson, lon-lat order !\n            },\n            properties: {}\n        };\n        const poly = this._spatialMask;\n        return inside(pt, poly);\n    }\n\n    /**\n     * Returns if the grid doesn't contain the point\n     * @param   {Number} lon - longitude\n     * @param   {Number} lat - latitude\n     * @returns {Boolean}\n     */\n    notContains(lon, lat) {\n        return !this.contains(lon, lat);\n    }\n\n    /**\n     * Interpolated value at lon-lat coordinates (bilinear method)\n     * @param   {Number} longitude\n     * @param   {Number} latitude\n     * @returns {Vector|Number} [u, v, magnitude]\n     *                          \n     * Source: https://github.com/cambecc/earth > product.js\n     */\n    interpolatedValueAt(lon, lat) {\n        if (this.notContains(lon, lat)) return null;\n\n        let [i, j] = this._getDecimalIndexes(lon, lat);\n        return this.interpolatedValueAtIndexes(i, j);\n    }\n\n    /**\n     * Interpolated value at i-j indexes (bilinear method)\n     * @param   {Number} i\n     * @param   {Number} j\n     * @returns {Vector|Number} [u, v, magnitude]\n     *\n     * Source: https://github.com/cambecc/earth > product.js\n     */\n    interpolatedValueAtIndexes(i, j) {\n        //         1      2           After converting λ and φ to fractional grid indexes i and j, we find the\n        //        fi  i   ci          four points 'G' that enclose point (i, j). These points are at the four\n        //         | =1.4 |           corners specified by the floor and ceiling of i and j. For example, given\n        //      ---G--|---G--- fj 8   i = 1.4 and j = 8.3, the four surrounding grid points are (1, 8), (2, 8),\n        //    j ___|_ .   |           (1, 9) and (2, 9).\n        //  =8.3   |      |\n        //      ---G------G--- cj 9   Note that for wrapped grids, the first column is duplicated as the last\n        //         |      |           column, so the index ci can be used without taking a modulo.\n\n        let indexes = this._getFourSurroundingIndexes(i, j);\n        let [fi, ci, fj, cj] = indexes;\n        let values = this._getFourSurroundingValues(fi, ci, fj, cj);\n        if (values) {\n            let [g00, g10, g01, g11] = values;\n            return this._doInterpolation(i - fi, j - fj, g00, g10, g01, g11);\n        }\n        return null;\n    }\n\n    /**\n     * Get decimal indexes\n     * @private\n     * @param {Number} lon\n     * @param {Number} lat\n     * @returns {Array}    [[Description]]\n     */\n    _getDecimalIndexes(lon, lat) {\n        if (this.longitudeNeedsToBeWrapped && lon < this.xllCorner) {\n            lon = lon + 360;\n        }\n        let i = (lon - this.xllCorner) / this.cellXSize;\n        let j = (this.yurCorner - lat) / this.cellYSize;\n        return [i, j];\n    }\n\n    /**\n     * Get surrounding indexes (integer), clampling on borders\n     * @private\n     * @param   {Number} i - decimal index\n     * @param   {Number} j - decimal index\n     * @returns {Array} [fi, ci, fj, cj]\n     */\n    _getFourSurroundingIndexes(i, j) {\n        let fi = Math.floor(i);\n        let ci = fi + 1;\n        // duplicate colum to simplify interpolation logic (wrapped value)\n        if (this.isContinuous && ci >= this.nCols) {\n            ci = 0;\n        }\n        ci = this._clampColumnIndex(ci);\n\n        let fj = this._clampRowIndex(Math.floor(j));\n        let cj = this._clampRowIndex(fj + 1);\n\n        return [fi, ci, fj, cj];\n    }\n\n    /**\n     * Get four surrounding values or null if not available,\n     * from 4 integer indexes\n     * @private\n     * @param   {Number} fi\n     * @param   {Number} ci\n     * @param   {Number} fj\n     * @param   {Number} cj\n     * @returns {Array} \n     */\n    _getFourSurroundingValues(fi, ci, fj, cj) {\n        var row;\n        if ((row = this.grid[fj])) {\n            // upper row ^^\n            var g00 = row[fi]; // << left\n            var g10 = row[ci]; // right >>\n            if (\n                this._isValid(g00) &&\n                this._isValid(g10) &&\n                (row = this.grid[cj])\n            ) {\n                // lower row vv\n                var g01 = row[fi]; // << left\n                var g11 = row[ci]; // right >>\n                if (this._isValid(g01) && this._isValid(g11)) {\n                    return [g00, g10, g01, g11]; // 4 values found!\n                }\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Nearest value at lon-lat coordinates\n     * @param   {Number} longitude\n     * @param   {Number} latitude\n     * @returns {Vector|Number}\n     */\n    valueAt(lon, lat) {\n        if (this.notContains(lon, lat)) return null;\n\n        let [i, j] = this._getDecimalIndexes(lon, lat);\n        let ii = Math.floor(i);\n        let jj = Math.floor(j);\n\n        const ci = this._clampColumnIndex(ii);\n        const cj = this._clampRowIndex(jj);\n\n        let value = this._valueAtIndexes(ci, cj);\n        if (this._inFilter) {\n            if (!this._inFilter(value)) return null;\n        }\n\n        return value;\n    }\n\n    /**\n     * Returns whether or not the field has a value at the point\n     * @param   {Number} lon - longitude\n     * @param   {Number} lat - latitude\n     * @returns {Boolean}\n     */\n    hasValueAt(lon, lat) {\n        let value = this.valueAt(lon, lat);\n        let hasValue = value !== null;\n\n        let included = true;\n        if (this._inFilter) {\n            included = this._inFilter(value);\n        }\n        return hasValue && included;\n    }\n\n    /**\n     * Returns if the grid has no value at the point\n     * @param   {Number} lon - longitude\n     * @param   {Number} lat - latitude\n     * @returns {Boolean}\n     */\n    notHasValueAt(lon, lat) {\n        return !this.hasValueAt(lon, lat);\n    }\n\n    /**\n     * Gives a random position to 'o' inside the grid\n     * @param {Object} [o] - an object (eg. a particle)\n     * @returns {{x: Number, y: Number}} - object with x, y (lon, lat)\n     */\n    randomPosition(o = {}) {\n        let i = (Math.random() * this.nCols) | 0;\n        let j = (Math.random() * this.nRows) | 0;\n\n        o.x = this._longitudeAtX(i);\n        o.y = this._latitudeAtY(j);\n\n        return o;\n    }\n\n    /**\n     * Value for grid indexes\n     * @param   {Number} i - column index (integer)\n     * @param   {Number} j - row index (integer)\n     * @returns {Vector|Number}\n     */\n    _valueAtIndexes(i, j) {\n        return this.grid[j][i]; // <-- j,i !!\n    }\n\n    /**\n     * Lon-Lat for grid indexes\n     * @param   {Number} i - column index (integer)\n     * @param   {Number} j - row index (integer)\n     * @returns {Number[]} [lon, lat]\n     */\n    _lonLatAtIndexes(i, j) {\n        let lon = this._longitudeAtX(i);\n        let lat = this._latitudeAtY(j);\n\n        return [lon, lat];\n    }\n\n    /**\n     * Longitude for grid-index\n     * @param   {Number} i - column index (integer)\n     * @returns {Number} longitude at the center of the cell\n     */\n    _longitudeAtX(i) {\n        let halfXPixel = this.cellXSize / 2.0;\n        let lon = this.xllCorner + halfXPixel + i * this.cellXSize;\n        if (this.longitudeNeedsToBeWrapped) {\n            lon = lon > 180 ? lon - 360 : lon;\n        }\n        return lon;\n    }\n\n    /**\n     * Latitude for grid-index\n     * @param   {Number} j - row index (integer)\n     * @returns {Number} latitude at the center of the cell\n     */\n    _latitudeAtY(j) {\n        let halfYPixel = this.cellYSize / 2.0;\n        return this.yurCorner - halfYPixel - j * this.cellYSize;\n    }\n\n    /**\n     * Apply the interpolation\n     * @abstract\n     * @private\n     */\n    /* eslint-disable no-unused-vars */\n    _doInterpolation(x, y, g00, g10, g01, g11) {\n        throw new TypeError('Must be overriden');\n    }\n    /* eslint-disable no-unused-vars */\n\n    /**\n     * Check the column index is inside the field,\n     * adjusting to min or max when needed\n     * @private\n     * @param   {Number} ii - index\n     * @returns {Number} i - inside the allowed indexes\n     */\n    _clampColumnIndex(ii) {\n        let i = ii;\n        if (ii < 0) {\n            i = 0;\n        }\n        let maxCol = this.nCols - 1;\n        if (ii > maxCol) {\n            i = maxCol;\n        }\n        return i;\n    }\n\n    /**\n     * Check the row index is inside the field,\n     * adjusting to min or max when needed\n     * @private\n     * @param   {Number} jj index\n     * @returns {Number} j - inside the allowed indexes\n     */\n    _clampRowIndex(jj) {\n        let j = jj;\n        if (jj < 0) {\n            j = 0;\n        }\n        let maxRow = this.nRows - 1;\n        if (jj > maxRow) {\n            j = maxRow;\n        }\n        return j;\n    }\n\n    /**\n     * Is valid (not 'null' nor 'undefined')\n     * @private\n     * @param   {Object} x object\n     * @returns {Boolean}\n     */\n    _isValid(x) {\n        return x !== null && x !== undefined;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Field.js","import Field from './Field';\n\n/**\n * Scalar Field\n */\nexport default class ScalarField extends Field {\n    /**\n     * Creates a ScalarField from the content of an ASCIIGrid file\n     * @param   {String}   asc\n     * @returns {ScalarField}\n     */\n    static fromASCIIGrid(asc, scaleFactor = 1) {\n        //console.time('ScalarField from ASC');\n\n        let lines = asc.split('\\n');\n\n        // Header\n        ScalarField._checkIsValidASCIIGridHeader(lines);\n\n        let n = /-?(?:0|[1-9]\\d*)(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/; // any number\n\n        const cellSize = parseFloat(lines[4].match(n)); // right now, no different x-y size is allowed\n        let p = {\n            nCols: parseInt(lines[0].match(n)),\n            nRows: parseInt(lines[1].match(n)),\n            xllCorner: parseFloat(lines[2].match(n)),\n            yllCorner: parseFloat(lines[3].match(n)),\n            cellXSize: cellSize,\n            cellYSize: cellSize\n        };\n        let noDataValue = lines[5]\n            .toUpperCase()\n            .replace('NODATA_VALUE', '')\n            .trim();\n\n        // Data (left-right and top-down)\n        let zs = []; // TODO Consider using TypedArray (& manage NO_DATA)\n        for (let i = 6; i < lines.length; i++) {\n            let line = lines[i].trim();\n            if (line === '') break;\n\n            let items = line.split(' ');\n            items.forEach(it => {\n                const v =\n                    it !== noDataValue ? parseFloat(it * scaleFactor) : null;\n                zs.push(v);\n            });\n        }\n        p.zs = zs;\n\n        //console.timeEnd('ScalarField from ASC');\n        return new ScalarField(p);\n    }\n\n    static _checkIsValidASCIIGridHeader(lines) {\n        const upperCasesLines = lines.map(lin => lin.toUpperCase());\n\n        const parameters = [\n            'NCOLS',\n            'NROWS',\n            'XLLCORNER',\n            'YLLCORNER',\n            'CELLSIZE',\n            'NODATA_VALUE'\n        ];\n\n        let i = 0;\n        for (let expected of parameters) {\n            let line = upperCasesLines[i];\n            let found = line.indexOf(expected) != -1;\n            if (!found) {\n                throw `Not valid ASCIIGrid: expected '${expected}' at line '${line}' [lin. nº ${i}]`;\n            }\n            i++;\n        }\n    }\n\n    /**\n     * Creates a ScalarField from the content of a GeoTIFF file, as read by geotiff.js\n     * @param   {ArrayBuffer}   data\n     * @param   {Number}   bandIndex\n     * @returns {ScalarField}\n     */\n    static fromGeoTIFF(data, bandIndex = 0) {\n        //console.time('ScalarField from GeoTIFF');\n\n        let tiff = GeoTIFF.parse(data); // geotiff.js\n        let image = tiff.getImage();\n        let rasters = image.readRasters();\n        let tiepoint = image.getTiePoints()[0];\n        let fileDirectory = image.getFileDirectory();\n        let [xScale, yScale] = fileDirectory.ModelPixelScale;\n\n        let zs = rasters[bandIndex]; // left-right and top-down order\n\n        if (fileDirectory.GDAL_NODATA) {\n            let noData = parseFloat(fileDirectory.GDAL_NODATA);\n            // console.log(noData);\n            let simpleZS = Array.from(zs); // to simple array, so null is allowed | TODO efficiency??\n            zs = simpleZS.map(function(z) {\n                return z === noData ? null : z;\n            });\n        }\n\n        let p = {\n            nCols: image.getWidth(),\n            nRows: image.getHeight(),\n            xllCorner: tiepoint.x,\n            yllCorner: tiepoint.y - image.getHeight() * yScale,\n            cellXSize: xScale,\n            cellYSize: yScale,\n            zs: zs\n        };\n\n        //console.timeEnd('ScalarField from GeoTIFF');\n        return new ScalarField(p);\n    }\n\n    constructor(params) {\n        super(params);\n        this.zs = params['zs'];\n\n        this.grid = this._buildGrid();\n        this._updateRange();\n        //console.log(`ScalarField created (${this.nCols} x ${this.nRows})`);\n    }\n\n    /**\n     * Builds a grid with a Number at each point, from an array\n     * 'zs' following x-ascending & y-descending order\n     * (same as in ASCIIGrid)\n     * @private\n     * @returns {Array.<Array.<Number>>} - grid[row][column]--> Number\n     */\n    _buildGrid() {\n        let grid = this._arrayTo2d(this.zs, this.nRows, this.nCols);\n        return grid;\n    }\n\n    _arrayTo2d(array, nRows, nCols) {\n        let grid = [];\n        let p = 0;\n        for (var j = 0; j < nRows; j++) {\n            var row = [];\n            for (var i = 0; i < nCols; i++, p++) {\n                let z = array[p];\n                row[i] = this._isValid(z) ? z : null; // <<<\n            }\n            grid[j] = row;\n        }\n        return grid;\n    }\n\n    _newDataArrays(params) {\n        params['zs'] = [];\n    }\n\n    _pushValueToArrays(params, value) {\n        params['zs'].push(value);\n    }\n\n    _makeNewFrom(params) {\n        return new ScalarField(params);\n    }\n\n    /**\n     * Calculate min & max values\n     * @private\n     * @returns {Array} - [min, max]\n     */\n    _calculateRange() {\n        var data = this.zs;\n        if (this._inFilter) {\n            data = data.filter(this._inFilter);\n        }\n        return [d3.min(data), d3.max(data)];\n    }\n\n    /**\n     * Bilinear interpolation for Number\n     * https://en.wikipedia.org/wiki/Bilinear_interpolation\n     * @param   {Number} x\n     * @param   {Number} y\n     * @param   {Number} g00\n     * @param   {Number} g10\n     * @param   {Number} g01\n     * @param   {Number} g11\n     * @returns {Number}\n     */\n    _doInterpolation(x, y, g00, g10, g01, g11) {\n        var rx = 1 - x;\n        var ry = 1 - y;\n        return g00 * rx * ry + g10 * x * ry + g01 * rx * y + g11 * x * y;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./ScalarField.js","/**\n *  2D Vector\n */\nexport default class Vector {\n\n    constructor(u, v) {\n        this.u = u;\n        this.v = v;\n    }\n\n    /**\n     * Magnitude\n     * @returns {Number}\n     */\n    magnitude() {\n        return Math.sqrt(this.u * this.u + this.v * this.v);\n    }\n\n    /**\n     * Angle in degrees (0 to 360º) --> Towards\n     * N is 0º and E is 90º\n     * @returns {Number}\n     */\n    directionTo() {\n        let verticalAngle = Math.atan2(this.u, this.v);\n        let inDegrees = verticalAngle * (180.0 / Math.PI);\n        if (inDegrees < 0) {\n            inDegrees = inDegrees + 360.0;\n        }\n        return inDegrees;\n    }\n\n    /**\n     * Angle in degrees (0 to 360º) From x-->\n     * N is 0º and E is 90º\n     * @returns {Number}\n     */\n    directionFrom() {\n        let a = this.directionTo();\n        let opposite = (a + 180.0) % 360.0;\n        return opposite;\n    }\n\n    /*\n        Degrees --> text\n        new Dictionary<int, string>\n        {\n            //{0, 23, 45, 68, 90, 113, 135, 158, 180, 203, 225, 248, 270, 293, 315, 338, 360};\n            {0, 'N'},\n            {23, 'NNE'},\n            {45, 'NE'},\n            {68, 'ENE'},\n            {90, 'E'},\n            {113, 'ESE'},\n            {135, 'SE'},\n            {158, 'SSE'},\n            {180, 'S'},\n            {203, 'SSW'},\n            {225, 'SW'},\n            {248, 'WSW'},\n            {270, 'W'},\n            {293, 'WNW'},\n            {315, 'NW'},\n            {338, 'NNW'},\n            {360, 'N'}\n        };\n    */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Vector.js","import Vector from './Vector';\nimport Field from './Field';\nimport ScalarField from './ScalarField';\n\n/**\n *  A set of vectors assigned to a regular 2D-grid (lon-lat)\n *  (e.g. a raster representing winds for a region)\n */\nexport default class VectorField extends Field {\n    /**\n     * Creates a VectorField from the content of two ASCIIGrid files\n     * @param   {String} ascU - with u-component\n     * @param   {String} ascV - with v-component\n     * @returns {VectorField}\n     */\n    static fromASCIIGrids(ascU, ascV, scaleFactor = 1) {\n        let u = ScalarField.fromASCIIGrid(ascU, scaleFactor);\n        let v = ScalarField.fromASCIIGrid(ascV, scaleFactor);\n        let p = VectorField._paramsFromScalarFields(u, v);\n\n        return new VectorField(p);\n    }\n\n    /**\n     * Creates a VectorField from the content of two different Geotiff files\n     * @param   {ArrayBuffer} gtU - geotiff data with u-component (band 0)\n     * @param   {ArrayBuffer} gtV - geotiff data with v-component (band 0)\n     * @returns {VectorField}\n     */\n    static fromGeoTIFFs(gtU, gtV) {\n        let u = ScalarField.fromGeoTIFF(gtU);\n        let v = ScalarField.fromGeoTIFF(gtV);\n        let p = VectorField._paramsFromScalarFields(u, v);\n\n        return new VectorField(p);\n    }\n\n    /**\n     * Creates a VectorField from the content of Multiband Geotiff\n     * @param   {ArrayBuffer} geotiffData - multiband\n     * @param   {Array} bandIndexesForUV\n     * @returns {VectorField}\n     */\n    static fromMultibandGeoTIFF(geotiffData, bandIndexesForUV = [0, 1]) {\n        let u = ScalarField.fromGeoTIFF(geotiffData, bandIndexesForUV[0]);\n        let v = ScalarField.fromGeoTIFF(geotiffData, bandIndexesForUV[1]);\n        let p = VectorField._paramsFromScalarFields(u, v);\n\n        return new VectorField(p);\n    }\n\n    /**\n     * Build parameters for VectorField, from 2 ScalarFields.\n     * No validation at all (nor interpolation) is applied, so u and v\n     * must be 'compatible' from the source\n     * @param   {ScalarField} u\n     * @param   {ScalarField} v\n     * @returns {Object} - parameters to build VectorField\n     */\n    static _paramsFromScalarFields(u, v) {\n        // TODO check u & v compatibility (cellSize...)\n        let p = {\n            nCols: u.nCols,\n            nRows: u.nRows,\n            xllCorner: u.xllCorner,\n            yllCorner: u.yllCorner,\n            cellXSize: u.cellXSize,\n            cellYSize: u.cellYSize,\n            us: u.zs,\n            vs: v.zs\n        };\n        return p;\n    }\n\n    constructor(params) {\n        super(params);\n\n        this.us = params['us'];\n        this.vs = params['vs'];\n        this.grid = this._buildGrid();\n        this.range = this._calculateRange();\n    }\n\n    /**\n     * Get a derived field, from a computation on \n     * the VectorField\n     * @param   {String} type ['magnitude' | 'directionTo' | 'directionFrom']\n     * @returns {ScalarField}\n     */\n    getScalarField(type) {\n        let f = this._getFunctionFor(type);\n        let p = {\n            nCols: this.params.nCols,\n            nRows: this.params.nRows,\n            xllCorner: this.params.xllCorner,\n            yllCorner: this.params.yllCorner,\n            cellXSize: this.params.cellXSize,\n            cellYSize: this.params.cellYSize,\n            zs: this._applyOnField(f)\n        };\n        return new ScalarField(p);\n    }\n\n    _getFunctionFor(type) {\n        return function(u, v) {\n            let uv = new Vector(u, v);\n            return uv[type](); // magnitude, directionTo, directionFrom\n        };\n    }\n\n    _applyOnField(func) {\n        let zs = [];\n        let n = this.numCells();\n        for (var i = 0; i < n; i++) {\n            let u = this.us[i];\n            let v = this.vs[i];\n            if (this._isValid(u) && this._isValid(v)) {\n                zs.push(func(u, v));\n            } else {\n                zs.push(null);\n            }\n        }\n        return zs;\n    }\n\n    /**\n     * Builds a grid with a Vector at each point, from two arrays\n     * 'us' and 'vs' following x-ascending & y-descending order\n     * (same as in ASCIIGrid)\n     * @returns {Array.<Array.<Vector>>} - grid[row][column]--> Vector\n     */\n    _buildGrid() {\n        let grid = this._arraysTo2d(this.us, this.vs, this.nRows, this.nCols);\n        return grid;\n    }\n\n    _arraysTo2d(us, vs, nRows, nCols) {\n        let grid = [];\n        let p = 0;\n\n        for (var j = 0; j < nRows; j++) {\n            var row = [];\n            for (var i = 0; i < nCols; i++, p++) {\n                let u = us[p],\n                    v = vs[p];\n                let valid = this._isValid(u) && this._isValid(v);\n                row[i] = valid ? new Vector(u, v) : null; // <<<\n            }\n            grid[j] = row;\n        }\n        return grid;\n    }\n\n    _newDataArrays(params) {\n        params['us'] = [];\n        params['vs'] = [];\n    }\n    _pushValueToArrays(params, value) {\n        //console.log(value);\n        params['us'].push(value.u);\n        params['vs'].push(value.v);\n    }\n    _makeNewFrom(params) {\n        return new VectorField(params);\n    }\n\n    /**\n     * Calculate min & max values (magnitude)\n     * @private\n     * @returns {Array}\n     */\n    _calculateRange() {\n        // TODO make a clearer method for getting these vectors...\n        let vectors = this.getCells().map(pt => pt.value).filter(function(v) {\n            return v !== null;\n        });\n\n        if (this._inFilter) {\n            vectors = vectors.filter(this._inFilter);\n        }\n\n        // TODO check memory crash with high num of vectors!\n        let magnitudes = vectors.map(v => v.magnitude());\n        let min = d3.min(magnitudes);\n        let max = d3.max(magnitudes);\n\n        return [min, max];\n    }\n\n    /**\n     * Bilinear interpolation for Vector\n     * https://en.wikipedia.org/wiki/Bilinear_interpolation\n     * @param   {Number} x\n     * @param   {Number} y\n     * @param   {Number[]} g00\n     * @param   {Number[]} g10\n     * @param   {Number[]} g01\n     * @param   {Number[]} g11\n     * @returns {Vector}\n     */\n    _doInterpolation(x, y, g00, g10, g01, g11) {\n        var rx = 1 - x;\n        var ry = 1 - y;\n        var a = rx * ry,\n            b = x * ry,\n            c = rx * y,\n            d = x * y;\n        var u = g00.u * a + g10.u * b + g01.u * c + g11.u * d;\n        var v = g00.v * a + g10.v * b + g01.v * c + g11.v * d;\n        return new Vector(u, v);\n    }\n\n    /**\n     * Is valid (not 'null' nor 'undefined')\n     * @private\n     * @param   {Object} x object\n     * @returns {Boolean}\n     */\n    _isValid(x) {\n        return x !== null && x !== undefined;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./VectorField.js","/**\n *   Control for a simple legend with a colorbar\n *   References:\n *      - http://jsfiddle.net/ramnathv/g8stqcf6/\n *      - http://jsfiddle.net/vis4/cYLZH/\n */\nL.Control.ColorBar = L.Control.extend({\n    options: {\n        position: 'bottomleft',\n        width: 300, // for colorbar itself (control is wider)\n        height: 15,\n        margin: 15,\n        background: '#fff',\n        textColor: 'black',\n        steps: 100,\n        decimals: 2,\n        units: 'uds', // ej: m/s\n        title: 'Legend', // ej: Ocean Currents\n        labels: [], // empty for no labels\n        labelFontSize: 10,\n        labelTextPosition: 'middle' // start | middle | end\n    },\n\n    initialize: function(color, range, options) {\n        this.color = color; // 'chromajs' scale function\n        this.range = range; // [min, max]\n        L.Util.setOptions(this, options);\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n        let div = L.DomUtil.create(\n            'div',\n            'leaflet-control-colorBar leaflet-bar leaflet-control'\n        );\n        div.style.padding = '10px';\n\n        L.DomEvent\n            .addListener(div, 'click', L.DomEvent.stopPropagation)\n            .addListener(div, 'click', L.DomEvent.preventDefault);\n        div.style.backgroundColor = this.options.background;\n        div.style.cursor = 'text';\n        div.innerHTML = this.title() + this.palette();\n        return div;\n    },\n\n    title: function() {\n        let d = document.createElement('div');\n        d3\n            .select(d)\n            .append('span')\n            .style('color', this.options.textColor)\n            .style('display', 'block')\n            .style('margin-bottom', '5px')\n            .attr('class', 'leaflet-control-colorBar-title')\n            .text(this.options.title);\n        return d.innerHTML;\n    },\n\n    palette: function() {\n        let d = document.createElement('div');\n        let svg = this._createSvgIn(d);\n\n        this._appendColorBarTo(svg);\n\n        if (this.options.labels) {\n            this._appendLabelsTo(svg);\n        }\n\n        return d.innerHTML;\n    },\n\n    _createSvgIn: function(d) {\n        let spaceForLabels = this.options.labels ? this.options.margin : 0;\n        let svg = d3\n            .select(d)\n            .append('svg')\n            .attr('width', this.options.width + this.options.margin * 2)\n            .attr('height', this.options.height + spaceForLabels);\n        return svg;\n    },\n\n    _appendColorBarTo: function(svg) {\n        const colorPerValue = this._getColorPerValue();\n        const w = this.options.width / colorPerValue.length;\n\n        let groupBars = svg.append('g').attr('id', 'colorBar-buckets');\n        let buckets = groupBars\n            .selectAll('rect')\n            .data(colorPerValue)\n            .enter()\n            .append('rect');\n        buckets\n            .attr('x', (d, i) => i * w + this.options.margin)\n            .attr('y', () => 0)\n            .attr('height', () => this.options.height /*w * 4*/)\n            .attr('width', () => w)\n            .attr('stroke-width', 2)\n            .attr('stroke-linecap', 'butt')\n            .attr('stroke', d => d.color.hex())\n            .attr('fill', d => d.color.hex());\n        buckets\n            .append('title')\n            .text(\n                d =>\n                    `${d.value.toFixed(this.options.decimals)} ${this.options\n                        .units}`\n            );\n    },\n\n    _appendLabelsTo: function(svg) {\n        const positionPerLabelValue = this._getPositionPerLabelValue();\n        //const w = this.options.width / colorPerValue.length;\n        let groupLabels = svg.append('g').attr('id', 'colorBar-labels');\n        let labels = groupLabels\n            .selectAll('text')\n            .data(positionPerLabelValue)\n            .enter()\n            .append('text');\n        labels\n            .attr('x', d => d.position + this.options.margin)\n            .attr('y', this.options.height + this.options.margin)\n            .attr('font-size', `${this.options.labelFontSize}px`)\n            .attr('text-anchor', this.options.labelTextPosition)\n            .attr('fill', this.options.textColor)\n            .attr('class', 'leaflet-control-colorBar-label')\n            .text(d => `${d.value.toFixed(this.options.decimals)}`);\n    },\n\n    _getColorPerValue: function() {\n        const [min, max] = this.range;\n        let delta = (max - min) / this.options.steps;\n        let data = d3.range(min, max + delta, delta);\n        let colorPerValue = data.map(d => {\n            return {\n                value: d,\n                color: this.color(d)\n            };\n        });\n        return colorPerValue;\n    },\n\n    _getPositionPerLabelValue: function() {\n        var xPositionFor = d3\n            .scaleLinear()\n            .range([0, this.options.width])\n            .domain(this.range);\n        let data = this.options.labels;\n        let positionPerLabel = data.map(d => {\n            return {\n                value: d,\n                position: xPositionFor(d)\n            };\n        });\n        return positionPerLabel;\n    }\n});\n\nL.control.colorBar = function(color, range, options) {\n    return new L.Control.ColorBar(color, range, options);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./control/L.Control.ColorBar.js","/**\n * Abstract class for a Field layer on canvas, aka 'a Raster layer'\n * (ScalarField or a VectorField)\n */\nL.CanvasLayer.Field = L.CanvasLayer.extend({\n    options: {\n        mouseMoveCursor: {\n            value: 'pointer',\n            noValue: 'default'\n        },\n        opacity: 1,\n        onClick: null,\n        onMouseMove: null,\n        inFilter: null\n    },\n\n    initialize: function(field, options) {\n        L.Util.setOptions(this, options);\n        this._visible = true;\n        if (field) {\n            this.setData(field);\n        }\n    },\n\n    getEvents: function() {\n        var events = L.CanvasLayer.prototype.getEvents.call(this);\n        events.zoomstart = this._hideCanvas.bind(this);\n        events.zoomend = this._showCanvas.bind(this);\n        return events;\n    },\n\n    onLayerDidMount: function() {\n        this._enableIdentify();\n        this._ensureCanvasAlignment();\n    },\n\n    show() {\n        this._visible = true;\n        this._showCanvas();\n        this._enableIdentify();\n    },\n\n    hide() {\n        this._visible = false;\n        this._hideCanvas();\n        this._disableIdentify();\n    },\n\n    isVisible() {\n        return this._visible;\n    },\n\n    _showCanvas() {\n        if (this._canvas && this._visible) {\n            this._canvas.style.visibility = 'visible';\n        }\n    },\n\n    _hideCanvas() {\n        if (this._canvas) {\n            this._canvas.style.visibility = 'hidden';\n        }\n    },\n\n    _enableIdentify() {\n        this._map.on('click', this._onClick, this);\n        this._map.on('mousemove', this._onMouseMove, this);\n\n        this.options.onClick && this.on('click', this.options.onClick, this);\n        this.options.onMouseMove &&\n            this.on('mousemove', this.options.onMouseMove, this);\n    },\n\n    _disableIdentify() {\n        this._map.off('click', this._onClick, this);\n        this._map.off('mousemove', this._onMouseMove, this);\n\n        this.options.onClick && this.off('click', this.options.onClick, this);\n        this.options.onMouseMove &&\n            this.off('mousemove', this.options.onMouseMove, this);\n    },\n\n    _ensureCanvasAlignment() {\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n        L.DomUtil.setPosition(this._canvas, topLeft);\n    },\n\n    onLayerWillUnmount: function() {\n        this._disableIdentify();\n    },\n\n    needRedraw() {\n        if (this._map && this._field) {\n            L.CanvasLayer.prototype.needRedraw.call(this);\n        }\n    },\n\n    /* eslint-disable no-unused-vars */\n    onDrawLayer: function(viewInfo) {\n        throw new TypeError('Must be overriden');\n    },\n    /* eslint-enable no-unused-vars */\n\n    setData: function(field) {\n        this.options.inFilter && field.setFilter(this.options.inFilter);\n        this._field = field;\n        this.needRedraw();\n        this.fire('load');\n    },\n\n    setFilter: function(f) {\n        this.options.inFilter = f;\n        this._field && this._field.setFilter(f);\n        this.needRedraw();\n    },\n\n    setOpacity: function(opacity) {\n        this.options.opacity = opacity;\n\n        if (this._canvas) {\n            this._updateOpacity();\n        }\n        return this;\n    },\n\n    getBounds: function() {\n        let bb = this._field.extent();\n\n        let southWest = L.latLng(bb[1], bb[0]),\n            northEast = L.latLng(bb[3], bb[2]);\n        let bounds = L.latLngBounds(southWest, northEast);\n        return bounds;\n    },\n\n    _onClick: function(e) {\n        let v = this._queryValue(e);\n        this.fire('click', v);\n    },\n\n    _onMouseMove: function(e) {\n        let v = this._queryValue(e);\n        this._changeCursorOn(v);\n        this.fire('mousemove', v);\n    },\n\n    _changeCursorOn: function(v) {\n        if (!this.options.mouseMoveCursor) return;\n\n        let { value, noValue } = this.options.mouseMoveCursor;\n        let style = this._map.getContainer().style;\n        style.cursor = v.value !== null ? value : noValue;\n    },\n\n    _updateOpacity: function() {\n        L.DomUtil.setOpacity(this._canvas, this.options.opacity);\n    },\n\n    _queryValue: function(e) {\n        let v = this._field\n            ? this._field.valueAt(e.latlng.lng, e.latlng.lat)\n            : null;\n        let result = {\n            latlng: e.latlng,\n            value: v\n        };\n        return result;\n    },\n\n    _getDrawingContext: function() {\n        let g = this._canvas.getContext('2d');\n        g.clearRect(0, 0, this._canvas.width, this._canvas.height);\n        return g;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.Field.js","import Cell from '../Cell';\n\n/**\n * ScalarField on canvas (a 'Raster')\n */\nL.CanvasLayer.ScalarField = L.CanvasLayer.Field.extend({\n    options: {\n        type: 'colormap', // [colormap|vector]\n        color: null, // function colorFor(value) [e.g. chromajs.scale],\n        interpolate: false, // Change to use interpolation\n        vectorSize: 20, // only used if 'vector'\n        arrowDirection: 'from' // [from|towards]\n    },\n\n    initialize: function(scalarField, options) {\n        L.CanvasLayer.Field.prototype.initialize.call(\n            this,\n            scalarField,\n            options\n        );\n        L.Util.setOptions(this, options);\n    },\n\n    _defaultColorScale: function() {\n        return chroma.scale(['white', 'black']).domain(this._field.range);\n    },\n\n    setColor(f) {\n        this.options.color = f;\n        this.needRedraw();\n    },\n\n    /* eslint-disable no-unused-vars */\n    onDrawLayer: function(viewInfo) {\n        if (!this.isVisible()) return;\n        this._updateOpacity();\n\n        let r = this._getRendererMethod();\n        //console.time('onDrawLayer');\n        r();\n        //console.timeEnd('onDrawLayer');\n    },\n    /* eslint-enable no-unused-vars */\n\n    _getRendererMethod: function() {\n        switch (this.options.type) {\n            case 'colormap':\n                return this._drawImage.bind(this);\n            case 'vector':\n                return this._drawArrows.bind(this);\n            default:\n                throw Error(`Unkwown renderer type: ${this.options.type}`);\n        }\n    },\n\n    _ensureColor: function() {\n        if (this.options.color === null) {\n            this.setColor(this._defaultColorScale());\n        }\n    },\n\n    _showCanvas() {\n        L.CanvasLayer.Field.prototype._showCanvas.call(this);\n        this.needRedraw(); // TODO check spurious redraw (e.g. hide/show without moving map)\n    },\n\n    /**\n     * Draws the field in an ImageData and applying it with putImageData.\n     * Used as a reference: http://geoexamples.com/d3-raster-tools-docs/code_samples/raster-pixels-page.html\n     */\n    _drawImage: function() {\n        this._ensureColor();\n\n        let ctx = this._getDrawingContext();\n        let width = this._canvas.width;\n        let height = this._canvas.height;\n\n        let img = ctx.createImageData(width, height);\n        let data = img.data;\n\n        this._prepareImageIn(data, width, height);\n        ctx.putImageData(img, 0, 0);\n    },\n\n    /**\n     * Prepares the image in data, as array with RGBAs\n     * [R1, G1, B1, A1, R2, G2, B2, A2...]\n     * @private\n     * @param {[[Type]]} data   [[Description]]\n     * @param {Numver} width\n     * @param {Number} height\n     */\n    _prepareImageIn(data, width, height) {\n        let f = this.options.interpolate ? 'interpolatedValueAt' : 'valueAt';\n\n        let pos = 0;\n        for (let j = 0; j < height; j++) {\n            for (let i = 0; i < width; i++) {\n                let pointCoords = this._map.containerPointToLatLng([i, j]);\n                let lon = pointCoords.lng;\n                let lat = pointCoords.lat;\n\n                let v = this._field[f](lon, lat); // 'valueAt' | 'interpolatedValueAt' || TODO check some 'artifacts'\n                if (v !== null) {\n                    let color = this._getColorFor(v);\n                    let [R, G, B, A] = color.rgba();\n                    data[pos] = R;\n                    data[pos + 1] = G;\n                    data[pos + 2] = B;\n                    data[pos + 3] = parseInt(A * 255); // not percent in alpha but hex 0-255\n                }\n                pos = pos + 4;\n            }\n        }\n    },\n\n    /**\n     * Draws the field as a set of arrows. Direction from 0 to 360 is assumed.\n     */\n    _drawArrows: function() {\n        const bounds = this._pixelBounds();\n        const pixelSize = (bounds.max.x - bounds.min.x) / this._field.nCols;\n\n        var stride = Math.max(\n            1,\n            Math.floor(1.2 * this.options.vectorSize / pixelSize)\n        );\n\n        const ctx = this._getDrawingContext();\n        ctx.strokeStyle = this.options.color;\n\n        var currentBounds = this._map.getBounds();\n\n        for (var y = 0; y < this._field.height; y = y + stride) {\n            for (var x = 0; x < this._field.width; x = x + stride) {\n                let [lon, lat] = this._field._lonLatAtIndexes(x, y);\n                let v = this._field.valueAt(lon, lat);\n                let center = L.latLng(lat, lon);\n                if (v !== null && currentBounds.contains(center)) {\n                    let cell = new Cell(\n                        center,\n                        v,\n                        this.cellXSize,\n                        this.cellYSize\n                    );\n                    this._drawArrow(cell, ctx);\n                }\n            }\n        }\n    },\n\n    _pixelBounds: function() {\n        const bounds = this.getBounds();\n        const northWest = this._map.latLngToContainerPoint(\n            bounds.getNorthWest()\n        );\n        const southEast = this._map.latLngToContainerPoint(\n            bounds.getSouthEast()\n        );\n        var pixelBounds = L.bounds(northWest, southEast);\n        return pixelBounds;\n    },\n\n    _drawArrow: function(cell, ctx) {\n        var projected = this._map.latLngToContainerPoint(cell.center);\n\n        // colormap vs. simple color\n        let color = this.options.color;\n        if (typeof color === 'function') {\n            ctx.strokeStyle = color(cell.value);\n        }\n\n        const size = this.options.vectorSize;\n        ctx.save();\n\n        ctx.translate(projected.x, projected.y);\n\n        let rotationRads = (90 + cell.value) * Math.PI / 180; // from, by default\n        if (this.options.arrowDirection === 'towards') {\n            rotationRads = rotationRads + Math.PI;\n        }\n        ctx.rotate(rotationRads);\n\n        ctx.beginPath();\n        ctx.moveTo(-size / 2, 0);\n        ctx.lineTo(+size / 2, 0);\n        ctx.moveTo(size * 0.25, -size * 0.25);\n        ctx.lineTo(+size / 2, 0);\n        ctx.lineTo(size * 0.25, size * 0.25);\n        ctx.stroke();\n        ctx.restore();\n    },\n\n    /**\n     * Gets a chroma color for a pixel value, according to 'options.color'\n     */\n    _getColorFor(v) {\n        let c = this.options.color; // e.g. for a constant 'red'\n        if (typeof c === 'function') {\n            c = this.options.color(v);\n        }\n        let color = chroma(c); // to be more flexible, a chroma color object is always created || TODO improve efficiency\n        return color;\n    }\n});\n\nL.canvasLayer.scalarField = function(scalarField, options) {\n    return new L.CanvasLayer.ScalarField(scalarField, options);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.ScalarField.js","/**\n *  Simple layer with lon-lat points\n *\n *  TODO rename to SimplePoint?\n */\nL.CanvasLayer.SimpleLonLat = L.CanvasLayer.extend({\n    options: {\n        color: 'gray'\n    },\n\n    initialize: function(points, options) {\n        this.points = points;\n        L.Util.setOptions(this, options);\n    },\n\n    onLayerDidMount: function() {\n        // -- prepare custom drawing\n    },\n\n    onLayerWillUnmount: function() {\n        // -- custom cleanup\n    },\n\n    /* eslint-disable no-unused-vars */\n    setData: function(data) {\n        // -- custom data set\n        this.needRedraw(); // -- call to drawLayer\n    },\n    /* eslint-enable no-unused-vars */\n\n    onDrawLayer: function(viewInfo) {\n        // canvas preparation\n        let g = viewInfo.canvas.getContext('2d');\n        g.clearRect(0, 0, viewInfo.canvas.width, viewInfo.canvas.height);\n        g.fillStyle = this.options.color;\n\n        for (let point of this.points) {\n            let p = viewInfo.layer._map.latLngToContainerPoint(point);\n            g.beginPath();\n            //g.arc(p.x, p.y, 1, 0, Math.PI * 2); // circle | TODO style 'function' as parameter?\n            g.fillRect(p.x, p.y, 2, 2); //simple point\n            g.fill();\n            g.closePath();\n            g.stroke();\n        }\n    },\n\n    getBounds: function() {\n        // TODO: bounding with points...\n        let xs = this.points.map(pt => pt.lng);\n        let ys = this.points.map(pt => pt.lat);\n\n        let xmin = Math.min(...xs);\n        let ymin = Math.min(...ys);\n        let xmax = Math.max(...xs);\n        let ymax = Math.max(...ys);\n\n        let southWest = L.latLng(ymin, xmin),\n            northEast = L.latLng(ymax, xmax);\n        let bounds = L.latLngBounds(southWest, northEast); // TODO FIX ERROR ? half-pixel?\n        return bounds;\n    }\n});\n\nL.canvasLayer.simpleLonLat = function(lonslats, options) {\n    return new L.CanvasLayer.SimpleLonLat(lonslats, options);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.SimpleLonLat.js","/**\n * Animated VectorField on canvas\n */\nL.CanvasLayer.VectorFieldAnim = L.CanvasLayer.Field.extend({\n    options: {\n        paths: 800,\n        color: 'white', // html-color | function colorFor(value) [e.g. chromajs.scale]\n        width: 1.0, // number | function widthFor(value)\n        fade: 0.96, // 0 to 1\n        duration: 20, // milliseconds per 'frame'\n        maxAge: 200, // number of maximum frames per path\n        velocityScale: 1 / 5000\n    },\n\n    initialize: function(vectorField, options) {\n        L.CanvasLayer.Field.prototype.initialize.call(\n            this,\n            vectorField,\n            options\n        );\n        L.Util.setOptions(this, options);\n\n        this.timer = null;\n    },\n\n    onLayerDidMount: function() {\n        L.CanvasLayer.Field.prototype.onLayerDidMount.call(this);\n        this._map.on('move resize', this._stopAnimation, this);\n    },\n\n    onLayerWillUnmount: function() {\n        L.CanvasLayer.Field.prototype.onLayerWillUnmount.call(this);\n        this._map.off('move resize', this._stopAnimation, this);\n        this._stopAnimation();\n    },\n\n    _hideCanvas: function _showCanvas() {\n        L.CanvasLayer.Field.prototype._hideCanvas.call(this);\n        this._stopAnimation();\n    },\n\n    onDrawLayer: function(viewInfo) {\n        if (!this._field || !this.isVisible()) return;\n\n        this._updateOpacity();\n\n        let ctx = this._getDrawingContext();\n        let paths = this._prepareParticlePaths();\n\n        this.timer = d3.timer(function() {\n            _moveParticles();\n            _drawParticles();\n        }, this.options.duration);\n\n        let self = this;\n\n        /**\n         * Builds the paths, adding 'particles' on each animation step, considering\n         * their properties (age / position source > target)\n         */\n        function _moveParticles() {\n            // let screenFactor = 1 / self._map.getZoom(); // consider using a 'screenFactor' to ponderate velocityScale\n            paths.forEach(function(par) {\n                if (par.age > self.options.maxAge) {\n                    // restart, on a random x,y\n                    par.age = 0;\n                    self._field.randomPosition(par);\n                }\n\n                let vector = self._field.valueAt(par.x, par.y);\n                if (vector === null) {\n                    par.age = self.options.maxAge;\n                } else {\n                    // the next point will be...\n                    let xt = par.x + vector.u * self.options.velocityScale; //* screenFactor;\n                    let yt = par.y + vector.v * self.options.velocityScale; //* screenFactor;\n\n                    if (self._field.hasValueAt(xt, yt)) {\n                        par.xt = xt;\n                        par.yt = yt;\n                        par.m = vector.magnitude();\n                    } else {\n                        // not visible anymore...\n                        par.age = self.options.maxAge;\n                    }\n                }\n                par.age += 1;\n            });\n        }\n\n        /**\n         * Draws the paths on each step\n         */\n        function _drawParticles() {\n            // Previous paths...\n            let prev = ctx.globalCompositeOperation;\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            //ctx.globalCompositeOperation = 'source-over';\n            ctx.globalCompositeOperation = prev;\n\n            // fading paths...\n            ctx.fillStyle = `rgba(0, 0, 0, ${self.options.fade})`;\n            ctx.lineWidth = self.options.width;\n            ctx.strokeStyle = self.options.color;\n\n            // New paths\n            paths.forEach(function(par) {\n                self._drawParticle(viewInfo, ctx, par);\n            });\n        }\n    },\n\n    _drawParticle(viewInfo, ctx, par) {\n        let source = new L.latLng(par.y, par.x);\n        let target = new L.latLng(par.yt, par.xt);\n\n        if (\n            viewInfo.bounds.contains(source) &&\n            par.age <= this.options.maxAge\n        ) {\n            let pA = viewInfo.layer._map.latLngToContainerPoint(source);\n            let pB = viewInfo.layer._map.latLngToContainerPoint(target);\n\n            ctx.beginPath();\n            ctx.moveTo(pA.x, pA.y);\n            ctx.lineTo(pB.x, pB.y);\n\n            // next-step movement\n            par.x = par.xt;\n            par.y = par.yt;\n\n            // colormap vs. simple color\n            let color = this.options.color;\n            if (typeof color === 'function') {\n                ctx.strokeStyle = color(par.m);\n            }\n\n            let width = this.options.width;\n            if (typeof width === 'function') {\n                ctx.lineWidth = width(par.m);\n            }\n\n            ctx.stroke();\n        }\n    },\n\n    _prepareParticlePaths: function() {\n        let paths = [];\n\n        for (var i = 0; i < this.options.paths; i++) {\n            let p = this._field.randomPosition();\n            p.age = this._randomAge();\n            paths.push(p);\n        }\n        return paths;\n    },\n\n    _randomAge: function() {\n        return Math.floor(Math.random() * this.options.maxAge);\n    },\n\n    _stopAnimation: function() {\n        if (this.timer) {\n            this.timer.stop();\n        }\n    }\n});\n\nL.canvasLayer.vectorFieldAnim = function(vectorField, options) {\n    return new L.CanvasLayer.VectorFieldAnim(vectorField, options);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.VectorFieldAnim.js","/*\n  1.0.1 (downloaded from https://github.com/Sumbera/gLayers.Leaflet/releases/tag/v1.0.1)\n\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc,\n  copyright Stanislav Sumbera,  2016 , sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n*/\n\nL.CanvasLayer = L.Layer.extend({\n    // -- initialized is called on prototype\n    initialize: function (options) {\n        this._map = null;\n        this._canvas = null;\n        this._frame = null;\n        this._delegate = null;\n        L.setOptions(this, options);\n    },\n\n    delegate: function (del) {\n        this._delegate = del;\n        return this;\n    },\n\n    needRedraw: function () {\n        if (!this._frame) {\n            this._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n        }\n        return this;\n    },\n\n    //-------------------------------------------------------------\n    _onLayerDidResize: function (resizeEvent) {\n        this._canvas.width = resizeEvent.newSize.x;\n        this._canvas.height = resizeEvent.newSize.y;\n    },\n    //-------------------------------------------------------------\n    _onLayerDidMove: function () {\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n        L.DomUtil.setPosition(this._canvas, topLeft);\n        this.drawLayer();\n    },\n    //-------------------------------------------------------------\n    getEvents: function () {\n        var events = {\n            resize: this._onLayerDidResize,\n            moveend: this._onLayerDidMove\n        };\n        if (this._map.options.zoomAnimation && L.Browser.any3d) {\n            events.zoomanim = this._animateZoom;\n        }\n\n        return events;\n    },\n    //-------------------------------------------------------------\n    onAdd: function (map) {\n        this._map = map;\n        this._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n        this.tiles = {};\n\n        var size = this._map.getSize();\n        this._canvas.width = size.x;\n        this._canvas.height = size.y;\n\n        var animated = this._map.options.zoomAnimation && L.Browser.any3d;\n        L.DomUtil.addClass(this._canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\n\n\n        map._panes.overlayPane.appendChild(this._canvas);\n\n        map.on(this.getEvents(), this);\n\n        var del = this._delegate || this;\n        del.onLayerDidMount && del.onLayerDidMount(); // -- callback\n\n        this.needRedraw();\n    },\n\n    //-------------------------------------------------------------\n    onRemove: function (map) {\n        var del = this._delegate || this;\n        del.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n\n        map.getPanes().overlayPane.removeChild(this._canvas);\n\n        map.off(this.getEvents(), this);\n\n        this._canvas = null;\n\n    },\n\n    //------------------------------------------------------------\n    addTo: function (map) {\n        map.addLayer(this);\n        return this;\n    },\n    // --------------------------------------------------------------------------------\n    LatLonToMercator: function (latlon) {\n        return {\n            x: latlon.lng * 6378137 * Math.PI / 180,\n            y: Math.log(Math.tan((90 + latlon.lat) * Math.PI / 360)) * 6378137\n        };\n    },\n\n    //------------------------------------------------------------------------------\n    drawLayer: function () {\n        // -- todo make the viewInfo properties  flat objects.\n        var size = this._map.getSize();\n        var bounds = this._map.getBounds();\n        var zoom = this._map.getZoom();\n\n        var center = this.LatLonToMercator(this._map.getCenter());\n        var corner = this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize()));\n\n        var del = this._delegate || this;\n        del.onDrawLayer && del.onDrawLayer({\n            layer: this,\n            canvas: this._canvas,\n            bounds: bounds,\n            size: size,\n            zoom: zoom,\n            center: center,\n            corner: corner\n        });\n        this._frame = null;\n    },\n\n    //------------------------------------------------------------------------------\n    _animateZoom: function (e) {\n        var scale = this._map.getZoomScale(e.zoom);\n        var offset = this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(), e.zoom, e.center);\n\n        L.DomUtil.setTransform(this._canvas, offset, scale);\n    }\n});\n\nL.canvasLayer = function () {\n    return new L.CanvasLayer();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.js","var invariant = require('@turf/invariant');\nvar getCoord = invariant.getCoord;\nvar getCoords = invariant.getCoords;\n\n// http://en.wikipedia.org/wiki/Even%E2%80%93odd_rule\n// modified from: https://github.com/substack/point-in-polygon/blob/master/index.js\n// which was modified from http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n\n/**\n * Takes a {@link Point} and a {@link Polygon} or {@link MultiPolygon} and determines if the point resides inside the polygon. The polygon can\n * be convex or concave. The function accounts for holes.\n *\n * @name inside\n * @param {Feature<Point>} point input point\n * @param {Feature<Polygon|MultiPolygon>} polygon input polygon or multipolygon\n * @param {boolean} [ignoreBoundary=false] True if polygon boundary should be ignored when determining if the point is inside the polygon otherwise false.\n * @returns {boolean} `true` if the Point is inside the Polygon; `false` if the Point is not inside the Polygon\n * @example\n * var pt = turf.point([-77, 44]);\n * var poly = turf.polygon([[\n *   [-81, 41],\n *   [-81, 47],\n *   [-72, 47],\n *   [-72, 41],\n *   [-81, 41]\n * ]]);\n *\n * turf.inside(pt, poly);\n * //= true\n */\nmodule.exports = function (point, polygon, ignoreBoundary) {\n    // validation\n    if (!point) throw new Error('point is required');\n    if (!polygon) throw new Error('polygon is required');\n\n    var pt = getCoord(point);\n    var polys = getCoords(polygon);\n    var type = (polygon.geometry) ? polygon.geometry.type : polygon.type;\n    var bbox = polygon.bbox;\n\n    // Quick elimination if point is not inside bbox\n    if (bbox && inBBox(pt, bbox) === false) return false;\n\n    // normalize to multipolygon\n    if (type === 'Polygon') polys = [polys];\n\n    for (var i = 0, insidePoly = false; i < polys.length && !insidePoly; i++) {\n        // check if it is in the outer ring first\n        if (inRing(pt, polys[i][0], ignoreBoundary)) {\n            var inHole = false;\n            var k = 1;\n            // check for the point in any of the holes\n            while (k < polys[i].length && !inHole) {\n                if (inRing(pt, polys[i][k], !ignoreBoundary)) {\n                    inHole = true;\n                }\n                k++;\n            }\n            if (!inHole) insidePoly = true;\n        }\n    }\n    return insidePoly;\n};\n\n/**\n * inRing\n *\n * @private\n * @param {[number, number]} pt [x,y]\n * @param {Array<[number, number]>} ring [[x,y], [x,y],..]\n * @param {boolean} ignoreBoundary ignoreBoundary\n * @returns {boolean} inRing\n */\nfunction inRing(pt, ring, ignoreBoundary) {\n    var isInside = false;\n    if (ring[0][0] === ring[ring.length - 1][0] && ring[0][1] === ring[ring.length - 1][1]) ring = ring.slice(0, ring.length - 1);\n\n    for (var i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n        var xi = ring[i][0], yi = ring[i][1];\n        var xj = ring[j][0], yj = ring[j][1];\n        var onBoundary = (pt[1] * (xi - xj) + yi * (xj - pt[0]) + yj * (pt[0] - xi) === 0) &&\n            ((xi - pt[0]) * (xj - pt[0]) <= 0) && ((yi - pt[1]) * (yj - pt[1]) <= 0);\n        if (onBoundary) return !ignoreBoundary;\n        var intersect = ((yi > pt[1]) !== (yj > pt[1])) &&\n        (pt[0] < (xj - xi) * (pt[1] - yi) / (yj - yi) + xi);\n        if (intersect) isInside = !isInside;\n    }\n    return isInside;\n}\n\n/**\n * inBBox\n *\n * @private\n * @param {[number, number]} pt point [x,y]\n * @param {[number, number, number, number]} bbox BBox [west, south, east, north]\n * @returns {boolean} true/false if point is inside BBox\n */\nfunction inBBox(pt, bbox) {\n    return bbox[0] <= pt[0] &&\n           bbox[1] <= pt[1] &&\n           bbox[2] >= pt[0] &&\n           bbox[3] >= pt[1];\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/@turf/inside/index.js\n// module id = 11\n// module chunks = 0","/**\n * Unwrap a coordinate from a Point Feature, Geometry or a single coordinate.\n *\n * @name getCoord\n * @param {Array<number>|Geometry<Point>|Feature<Point>} obj Object\n * @returns {Array<number>} coordinates\n * @example\n * var pt = turf.point([10, 10]);\n *\n * var coord = turf.getCoord(pt);\n * //= [10, 10]\n */\nfunction getCoord(obj) {\n    if (!obj) throw new Error('obj is required');\n\n    var coordinates = getCoords(obj);\n\n    // getCoord() must contain at least two numbers (Point)\n    if (coordinates.length > 1 &&\n        typeof coordinates[0] === 'number' &&\n        typeof coordinates[1] === 'number') {\n        return coordinates;\n    } else {\n        throw new Error('Coordinate is not a valid Point');\n    }\n}\n\n/**\n * Unwrap coordinates from a Feature, Geometry Object or an Array of numbers\n *\n * @name getCoords\n * @param {Array<number>|Geometry|Feature} obj Object\n * @returns {Array<number>} coordinates\n * @example\n * var poly = turf.polygon([[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]);\n *\n * var coord = turf.getCoords(poly);\n * //= [[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]\n */\nfunction getCoords(obj) {\n    if (!obj) throw new Error('obj is required');\n    var coordinates;\n\n    // Array of numbers\n    if (obj.length) {\n        coordinates = obj;\n\n    // Geometry Object\n    } else if (obj.coordinates) {\n        coordinates = obj.coordinates;\n\n    // Feature\n    } else if (obj.geometry && obj.geometry.coordinates) {\n        coordinates = obj.geometry.coordinates;\n    }\n    // Checks if coordinates contains a number\n    if (coordinates) {\n        containsNumber(coordinates);\n        return coordinates;\n    }\n    throw new Error('No valid coordinates');\n}\n\n/**\n * Checks if coordinates contains a number\n *\n * @name containsNumber\n * @param {Array<any>} coordinates GeoJSON Coordinates\n * @returns {boolean} true if Array contains a number\n */\nfunction containsNumber(coordinates) {\n    if (coordinates.length > 1 &&\n        typeof coordinates[0] === 'number' &&\n        typeof coordinates[1] === 'number') {\n        return true;\n    }\n\n    if (Array.isArray(coordinates[0]) && coordinates[0].length) {\n        return containsNumber(coordinates[0]);\n    }\n    throw new Error('coordinates must only contain numbers');\n}\n\n/**\n * Enforce expectations about types of GeoJSON objects for Turf.\n *\n * @name geojsonType\n * @param {GeoJSON} value any GeoJSON object\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nfunction geojsonType(value, type, name) {\n    if (!type || !name) throw new Error('type and name required');\n\n    if (!value || value.type !== type) {\n        throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + value.type);\n    }\n}\n\n/**\n * Enforce expectations about types of {@link Feature} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name featureOf\n * @param {Feature} feature a feature with an expected geometry type\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} error if value is not the expected type.\n */\nfunction featureOf(feature, type, name) {\n    if (!feature) throw new Error('No feature passed');\n    if (!name) throw new Error('.featureOf() requires a name');\n    if (!feature || feature.type !== 'Feature' || !feature.geometry) {\n        throw new Error('Invalid input to ' + name + ', Feature with geometry required');\n    }\n    if (!feature.geometry || feature.geometry.type !== type) {\n        throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + feature.geometry.type);\n    }\n}\n\n/**\n * Enforce expectations about types of {@link FeatureCollection} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name collectionOf\n * @param {FeatureCollection} featureCollection a FeatureCollection for which features will be judged\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nfunction collectionOf(featureCollection, type, name) {\n    if (!featureCollection) throw new Error('No featureCollection passed');\n    if (!name) throw new Error('.collectionOf() requires a name');\n    if (!featureCollection || featureCollection.type !== 'FeatureCollection') {\n        throw new Error('Invalid input to ' + name + ', FeatureCollection required');\n    }\n    for (var i = 0; i < featureCollection.features.length; i++) {\n        var feature = featureCollection.features[i];\n        if (!feature || feature.type !== 'Feature' || !feature.geometry) {\n            throw new Error('Invalid input to ' + name + ', Feature with geometry required');\n        }\n        if (!feature.geometry || feature.geometry.type !== type) {\n            throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + feature.geometry.type);\n        }\n    }\n}\n\n/**\n * Get Geometry from Feature or Geometry Object\n *\n * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object\n * @returns {Geometry|null} GeoJSON Geometry Object\n * @throws {Error} if geojson is not a Feature or Geometry Object\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getGeom(point)\n * //={\"type\": \"Point\", \"coordinates\": [110, 40]}\n */\nfunction getGeom(geojson) {\n    if (!geojson) throw new Error('geojson is required');\n    if (geojson.geometry !== undefined) return geojson.geometry;\n    if (geojson.coordinates || geojson.geometries) return geojson;\n    throw new Error('geojson must be a valid Feature or Geometry Object');\n}\n\n/**\n * Get Geometry Type from Feature or Geometry Object\n *\n * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object\n * @returns {string} GeoJSON Geometry Type\n * @throws {Error} if geojson is not a Feature or Geometry Object\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getGeomType(point)\n * //=\"Point\"\n */\nfunction getGeomType(geojson) {\n    if (!geojson) throw new Error('geojson is required');\n    var geom = getGeom(geojson);\n    if (geom) return geom.type;\n}\n\nmodule.exports = {\n    geojsonType: geojsonType,\n    collectionOf: collectionOf,\n    featureOf: featureOf,\n    getCoord: getCoord,\n    getCoords: getCoords,\n    containsNumber: containsNumber,\n    getGeom: getGeom,\n    getGeomType: getGeomType\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/@turf/invariant/index.js\n// module id = 12\n// module chunks = 0","// base\nimport Vector from './Vector.js';\nwindow.L.Vector = Vector;\n\nimport Cell from './Cell.js';\nwindow.L.Cell = Cell;\n\nimport Field from './Field.js';\nwindow.L.Field = Field;\n\nimport ScalarField from './ScalarField.js';\nwindow.L.ScalarField = ScalarField;\n\nimport VectorField from './VectorField.js';\nwindow.L.VectorField = VectorField;\n\n// layer\nrequire('./layer/L.CanvasLayer.js');\nrequire('./layer/L.CanvasLayer.SimpleLonLat.js');\nrequire('./layer/L.CanvasLayer.Field.js');\nrequire('./layer/L.CanvasLayer.ScalarField.js');\nrequire('./layer/L.CanvasLayer.VectorFieldAnim.js');\n\n// control\nrequire('./control/L.Control.ColorBar.js');\n\n/* eslint-disable no-console */\nconsole.log('leaflet.canvaslayer.field v1.4.0 in progress...');\n/* eslint-enable no-console */\n\n\n\n// WEBPACK FOOTER //\n// ./_main.js"],"sourceRoot":""}